<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.min.css">
				<script type="text/javascript" src="../js/common.js" ></script>
		<!--App自定义的css-->
		<!-- <link rel="stylesheet" type="text/css" href="../css/app.css" /> -->
	  <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css">
     

		<style>
			h5 {
				margin: 5px 7px;
			}
			#addsel{
				width: 115px;
			    position: absolute;
			    right: 0px;
			}
		</style>
	</head>
	

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" id="back"></a>
			<h1 class="mui-title">添加药品</h1>
			<div>
				<select id="addsel">
				  <option value="volvo">+</option>
				  <option value="saab">扫码添加</option>
				  <option value="opel">处方添加</option>
				  <option value="audi">与上一次一样</option>
				</select>
			</div>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded" style="margin: 5px;">

				<form class="mui-input-group">
			
					<div class="mui-input-row">
						<label>药品名</label>
						<input type="text" class="mui-input-clear" placeholder="" id="pillDesc">
					</div>
					
					<div class="mui-input-row" >
						<label>每日用量</label>
						<input type="text" class="mui-input-clear" placeholder="" id="EatDay">
							
					</div>
						
					<div class="mui-input-row" >
						<label>每次用量</label>
						<input type="text" class="mui-input-clear" placeholder="" id="EatTimes">
					</div>
						
						<div class="mui-input-row">
						<label>药物用法</label>
						<input type="text" class="mui-input-clear" placeholder="" id="howEating">
					</div>

					<div class="mui-button-row">
						<button type="button" class="mui-btn mui-btn-primary" onclick="savePillMsg();">确认</button>&nbsp;&nbsp;
						<button type="button" class="mui-btn mui-btn-danger" onclick="clearPillMsg();">重置</button>
					</div>
				</form>

			</div>
			<div class="mui-content-padded" style="margin: 15px;background-color: #ccc;" >
				<!--	<div class="mui-input-row">
						<label>开始时间</label>
						<input type="date" class="mui-input-clear" placeholder="" id="startTime">
					</div>-->
						<div class="mui-input-row">
						<label>天数</label>
						<input type="text" class="mui-input-clear" placeholder="" id="times">
					</div>
				<div id="jsonPills">  
				<div style="border-color: #8e8383;border-style: dashed;">
					<div class="mui-input-row">
						<label>药品名</label>
						<input type="text" class="mui-input-clear" placeholder="" id="pillDesc" readonly="readonly">
					</div>
						<div class="mui-input-row" >
						<label>每日用量</label>
						<input type="text" class="mui-input-clear" placeholder="" id="EatDay" >
					</div>
						
					<div class="mui-input-row" id="EatTimes">
						<label>每次用量</label>
						<input type="text" class="mui-input-clear" placeholder="" id="EatTimes">
					</div>
				</div>
				
				
			</div>
			<div class="mui-button-row">
					<button type="button" class="mui-btn mui-btn-primary" onclick="saveAllPills();">保存药品</button>&nbsp;&nbsp;
				</div>
		</div>

		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/immersed.js" ></script>		
		<script type="text/javascript" src="../js/jquery-2.1.0.js" ></script>
		<script type="text/javascript" src="../js/json.js" ></script>
		<script src="../js/mui.picker.min.js"></script>
	


	<script>
	/**
	 * 每日用量
	 */
	
			
   var picker = new mui.PopPicker({
   layer: 4,   //4层菜单
   buttons:['取消','确定']   // 显示按钮名字

});
   picker.setData([{      
       text: '1',
       children: [{
               text: "日",
               children: [
                   {
                       text:'1',
                         children:[
                       {
             			  text: "次",
              		  }],
                   },
                    {
                       text:'2',
                        children:[
                       {
             			  text: "次",
              		  }],
                   },
                    {
                       text:'3',
                        children:[
                       {
             			  text: "次",
              		  }],
                   },
                    
                    
              
               ]
       }],
   
   }])
   



document.getElementById('EatDay').addEventListener('tap',function() {
   picker.show(function(getSelectedItems){   //获取选中的项（数组） 
     var p =  getSelectedItems[0].text+getSelectedItems[1].text
    +getSelectedItems[2].text+getSelectedItems[3].text;
    $('#EatDay').val(p);
 
   })

	   

});


   </script>

	<script>
		/**
		 * 每次用量
		 */
		
   var picker2 = new mui.PopPicker({
   layer: 4,   //4层菜单
   buttons:['取消','确定']   // 显示按钮名字

});
   picker2.setData([{      
       text: '1',
       children: [{
               text: "次",
               children: [
                   {
                       text:'1',
                         children:[
                       {
             			  text: "粒",
              		  }],
                   },
                    {
                       text:'2',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                    {
                       text:'3',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                    {
                       text:'4',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                    {
                       text:'5',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                   {
                       text:'6',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                   {
                       text:'7',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                   {
                       text:'8',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                   {
                       text:'9',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                   {
                       text:'10',
                        children:[
                       {
             			  text: "粒",
              		  }],
                   },
                    
              
               ]
       }],
   
   }])
		
		
document.getElementById('EatTimes').addEventListener('tap',function() {
   picker2.show(function(getSelectedItems){   //获取选中的项（数组） 
     var p =  getSelectedItems[0].text+getSelectedItems[1].text
    +getSelectedItems[2].text+getSelectedItems[3].text;
    $('#EatTimes').val(p);
 
   })

});
		
	
	</script>
	
	
	<script>
		

					var picker3 = new mui.PopPicker();
					picker3.setData([{
						value: 'beforefood',
						text: '饭前'
					}, {
						value: 'afterFood',
						text: '饭后'
					}]);
					document.getElementById('howEating').addEventListener('tap', function(event) {
						
						picker3.show(function(items) {
							
							var p=items[0].text;
							 $('#howEating').val(p);
						});
					}, false);
		
	</script>
		

		<script>
			var phone;
			var pillJson = {
			};
			 var saveDataAry=[];  
			var i=0;
			var ip ;
			 $(function(){
			 	phone = localStorage.getItem("phone");
			 	localStorage.removeItem("phone");
			 	var result = oneValues();
			 	ip = getIP();
			 	if(result){
			 		//查询药品信息
			 		var url = ip+"remiand/findPillMsgByPillId.do";
			 		var params = {
			 			pillId:result
			 		};
			 		$.ajax({
			 			type:"get",
			 			url:url,
			 			dataType:'json',
			 			data:params,
			 			async:false,
			 			success:function(res){
			 				console.log("res0:"+res.data)
			 				if(res.state==1&&res.data.length>0){
			 					//添加药品信息
			 					var data = res.data;
			 					var pillDesc = data[0].pillDesc;
			 					var EatDay = data[0].EatDay;
			 					var EatTimes= data[0].EatTimes;
			 					var whereEating = data[0].whereEating;
			 					var groom = data[0].groom;
			 					$('#pillDesc').val(pillDesc);
			 					$('#EatDay').val(EatDay);
			 					$('#EatTimes').val(EatTimes);
			 					$('#howEating').val(howEating);
			 					$('#groom').val(groom);
			 				}
			 			}
			 		});
			 	}
            $('#addsel').change(function(e){
               var selected_val = document.getElementById("addsel").value;
                console.log("selected_val:"+selected_val);
                if(selected_val=='saab'){
                	//扫码
                	window.location.href = "barcode.html";
                }
            })
        });
        
        //接收一个值
		function oneValues(){
				var result;
				var url=window.location.search; //获取url中"?"符后的字串  
				if(url.indexOf("?")!=-1){
				result = url.substr(url.indexOf("=")+1);
				}
				return result;
		}
		//保存到临时数据
		function savePillMsg(){
			var pillDesc = $('#pillDesc').val();
			
			var EatDay = $('#EatDay').val();
			var EatTimes = $('#EatTimes').val();
			var howEating = $('#howEating').val();
			pillJson["pillDesc"+i] = pillDesc;
			pillJson["EatDay"+i] = EatDay;
			pillJson["EatTimes"+i] = EatTimes;
			pillJson["howEating"+i] = howEating;
			i++;
			addJsonDiv(pillDesc,EatDay,EatTimes);
			console.log(pillJson);
			clearPillMsg();
		}
		//添加临时药品数据
		function addJsonDiv(pillDesc,EatDay,EatTimes){
			var div = '	<div style="border-color: #8e8383;border-style: dashed;">'
		+	'		<div class="mui-input-row">'
		+	'			<label>药品名</label>'
		+	'			<input type="text" value="'+pillDesc+'" class="mui-input-clear" placeholder="" id="pillDesc" readonly="readonly">'
		+	'		</div>'
		+	'			<div class="mui-input-row">'
		+	'			<label>每日用量</label>'
		+	'				<input type="text" value="'+EatDay+'" class="mui-input-clear" placeholder="" id="EatDay" >'
		+	'		</div>'
		
		+	'			<div class="mui-input-row">'
		+	'			<label>每次用量</label>'
		+	'				<input type="text" value="'+EatTimes+'" class="mui-input-clear" placeholder="" id="EatTimes" >'
		+	'		</div>'
		
		
		+	'	</div>';
		var jsonPills = $('#jsonPills');
		jsonPills.append(div);
		}
		/**保存所有药品信息，生成提醒记录*/
		function saveAllPills(){
			var times = $('#times').val();
			console.log("times:"+times)
			var url = ip+"remiand/makeRemiandBypills.do";
			var param = {
//				jsonPills:pillJson,
				phone:phone,
				times:times
			};
			var params = $.extend({},pillJson, param);
//			pillJson[i] = phone;
//			pillJson[i] = times;
//			saveDataAry.push(pillJson);
//			saveDataAry.push(params);
//			console.log("saveDataAry:"+saveDataAry);
			$.ajax({
				type:"post",
				url:url,
				async:true,
				dataType:"json",
				data:params, 
				contentType:'application/x-www-form-urlencoded; charset=UTF-8',
				success:function(res){
					if(res.state==1){
					$('#jsonPills').empty();
					window.location.href="myRemind.html";
				}
				}
			});
		}
		/*清除文本框*/
		function clearPillMsg(){
				$('#pillDesc').val("");
				$('#EatDay').val("");
			 	$('#EatTimes').val("");
			 	$('#howEating').val("");
		}
		/**
		 * 返回
		 */
		$('#back').click(function(){
			alert('55')
			window.open('myRemind.html');
		});
		</script>

	</body>

</html>